name: üîê Validate GitHub Secrets

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]

jobs:
  validate:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
    - name: üîç Check Secrets
      run: |
        echo "üîç Checking GitHub Secrets..."
        
        MISSING_SECRETS=()
        
        if [ -z "${{ secrets.EC2_HOST }}" ]; then
          MISSING_SECRETS+=("EC2_HOST")
        fi
        
        if [ -z "${{ secrets.EC2_USER }}" ]; then
          MISSING_SECRETS+=("EC2_USER")
        fi
        
        if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
          MISSING_SECRETS+=("SSH_PRIVATE_KEY")
        fi
        
        if [ -z "${{ secrets.EC2_PORT }}" ]; then
          echo "‚ö†Ô∏è EC2_PORT not set, will use default: 22"
        fi
        
        if [ ${#MISSING_SECRETS[@]} -eq 0 ]; then
          echo "‚úÖ All secrets are configured!"
          echo "‚úÖ EC2_HOST: ${{ secrets.EC2_HOST }}"
          echo "‚úÖ EC2_USER: ${{ secrets.EC2_USER }}"
          echo "‚úÖ EC2_PORT: ${{ secrets.EC2_PORT || '22 (default)' }}"
          echo "‚úÖ SSH_PRIVATE_KEY: [Configured]"
        else
          echo "‚ùå Missing secrets: ${MISSING_SECRETS[*]}"
          echo ""
          echo "üìù To add secrets, run:"
          echo ""
          echo "### GitHub CLI Method:"
          echo "\`\`\`bash"
          echo "gh secret set EC2_HOST --body '13.203.154.21'"
          echo "gh secret set EC2_USER --body 'ubuntu'"
          echo "gh secret set EC2_PORT --body '22'"
          echo "gh secret set SSH_PRIVATE_KEY < ~/your-key.pem"
          echo "\`\`\`"
          echo ""
          echo "### GitHub Web UI Method:"
          echo "1. Go to: Settings ‚Üí Secrets and variables ‚Üí Actions"
          echo "2. Click 'New repository secret'"
          echo "3. Add each secret manually"
          echo ""
          exit 1
        fi
